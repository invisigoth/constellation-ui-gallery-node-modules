{"version":3,"file":"Popover.js","sourceRoot":"","sources":["../../../src/components/Popover/Popover.tsx"],"names":[],"mappings":"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","sourcesContent":["import {\n  forwardRef,\n  useContext,\n  PropsWithoutRef,\n  Ref,\n  CSSProperties,\n  ReactElement,\n  useRef,\n  ReactNode,\n  useEffect,\n  useMemo,\n  useState,\n  useLayoutEffect\n} from 'react';\nimport { createPortal } from 'react-dom';\nimport { usePopper, PopperProps } from 'react-popper';\nimport { VirtualElement } from '@popperjs/core';\nimport { OffsetModifier } from '@popperjs/core/lib/modifiers/offset';\n\nimport { BaseProps, ForwardProps } from '../../types';\nimport {\n  useAfterInitialEffect,\n  useConfiguration,\n  useConsolidatedRef,\n  useElement,\n  useUID\n} from '../../hooks';\nimport { getRelativeOffset, popoverMap, windowIsAvailable } from '../../utils';\nimport { ConfigurationProps } from '../Configuration';\nimport { BackdropContext } from '../Backdrop/Backdrop';\n\nimport { PopoverManagerContext } from './PopoverContext';\nimport { StyledPopover, StyledPopoverArrow } from './Popover.styles';\nimport { placeAndContain } from './modifiers';\n\nexport type Delay = 'none' | 'short' | 'long';\nexport interface PopoverProps<Modifiers extends string = string> extends BaseProps {\n  /** The DOM element or [virtual element](https://popper.js.org/docs/v2/virtual-elements) that the Popover is positioned in reference to. */\n  target: Element | VirtualElement | null;\n  /**\n   * If true, the Popover will be visible.\n   * @default true\n   */\n  show?: boolean;\n  /**\n   * If true, the Popover will render outside of the current DOM hierarchy in a [portal](https://reactjs.org/docs/portals.html).\n   * @default true\n   */\n  portal?: boolean | ConfigurationProps['portalTarget'];\n  /**\n   * Delay on showing the Popover.\n   * @default 'none'\n   */\n  showDelay?: Delay;\n  /**\n   * Delay on hiding the Popover.\n   * @default 'none'\n   */\n  hideDelay?: Delay;\n  /**\n   * [React Popper Placement](https://popper.js.org/react-popper/v2/render-props/#placement)\n   * @default 'bottom'\n   */\n  placement?: PopperProps<Modifiers>['placement'];\n  /**\n   * [React Popper Strategy](https://popper.js.org/react-popper/v2/render-props/#strategy)\n   * @default 'absolute'\n   */\n  strategy?: PopperProps<Modifiers>['strategy'];\n  /**\n   * [React Popper Modifiers](https://popper.js.org/react-popper/v2/render-props/#modifiers)\n   * @default []\n   */\n  modifiers?: PopperProps<Modifiers>['modifiers'];\n  /**\n   * If true, an arrow will visually identify from which element the Popover is rendered.\n   * @default false\n   */\n  arrow?: boolean;\n  /** The group that the Popover belongs to. Popovers in the same group will be closed when others open. */\n  groupId?: string;\n  /**\n   * If true, the Popover will be visibly hidden when its target leaves the viewport.\n   * @default false\n   */\n  hideOnTargetHidden?: boolean;\n  /** Callback that runs when the popover is hidden */\n  onHide?: () => void;\n  /** The content of the Popover. */\n  children: ReactNode;\n  /** The ref of the wrapping element. */\n  ref?: Ref<HTMLDivElement>;\n}\n\nconst delays = {\n  none: 0,\n  short: 500,\n  long: 1000\n};\n\nconst Popover: <Modifiers extends string = string>(\n  props: PopoverProps<Modifiers> & ForwardProps\n) => ReactElement | null = forwardRef(function Popover(\n  {\n    show = true,\n    portal = true,\n    target,\n    placement = 'bottom',\n    strategy = 'fixed',\n    style,\n    modifiers = [],\n    arrow = false,\n    groupId,\n    showDelay = 'none',\n    hideDelay = 'none',\n    hideOnTargetHidden = false,\n    children,\n    onHide,\n    ...restProps\n  }: PropsWithoutRef<PopoverProps> & { style?: CSSProperties },\n  ref: PopoverProps['ref']\n) {\n  const { portalTarget: configurationPortal } = useConfiguration();\n  const { el: backdropPortal } = useContext(BackdropContext);\n  const { checkActive, setActive, popovers } = useContext(PopoverManagerContext);\n  const [popperEl, setPopperEl] = useElement<HTMLDivElement>();\n  const popperRef = useConsolidatedRef<HTMLDivElement>(ref, setPopperEl);\n  const arrowRef = useRef<HTMLDivElement>(null);\n  const forceUpdateRef = useRef<() => void>();\n  const initialOffset = useRef<Pick<DOMRect, 'x' | 'y'> | null>(null);\n  const [showPopover, setShowPopover] = useState(show);\n  const timeout = useRef<number>();\n  const uid = useUID();\n  const pointerId = useUID();\n\n  const resolvedTarget = target instanceof Element ? target : target?.contextElement;\n  const portalTarget = typeof portal === 'boolean' ? backdropPortal ?? configurationPortal : portal;\n\n  const memoedModifiers = useMemo(() => {\n    const flipEnabled = !!modifiers\n      .slice()\n      .reverse()\n      .find(modifier => modifier.name === 'flip' && modifier.enabled !== undefined)?.enabled;\n\n    return [\n      {\n        name: 'computeStyles',\n        options: {\n          gpuAcceleration: false\n        }\n      },\n      {\n        name: 'offset',\n        options: {\n          offset: [0, arrow ? 5.5 : 2]\n        }\n      },\n      { name: 'hide', enabled: hideOnTargetHidden },\n      { name: 'arrow', enabled: arrow, options: { element: arrowRef.current } },\n      {\n        name: 'preventOverflow',\n        options: {\n          tether: !modifiers.find(m => m.name === 'sameWidth'),\n          padding: 16\n        }\n      },\n      {\n        ...placeAndContain,\n        enabled: !flipEnabled\n      },\n      ...modifiers\n    ];\n  }, [arrow, hideOnTargetHidden, modifiers]);\n\n  const offset = useMemo(() => {\n    const offsetModifier = [...memoedModifiers]\n      .reverse()\n      .find(m => m.name === 'offset' && m.enabled !== false) as OffsetModifier | undefined;\n    return Array.isArray(offsetModifier?.options?.offset)\n      ? offsetModifier?.options?.offset[1] ?? 0\n      : 0;\n  }, [memoedModifiers]);\n\n  const { styles, attributes, forceUpdate } = usePopper(target, popperEl, {\n    placement,\n    strategy,\n    modifiers: memoedModifiers\n  });\n\n  if (forceUpdate) forceUpdateRef.current = forceUpdate;\n\n  // Setter-less useState to avoid re-running these constructors on every render with useRef.\n  const [ac] = useState(() => new AbortController());\n  const [observedSet] = useState(() => new WeakSet<Element>());\n  const [ro] = useState(\n    () =>\n      new ResizeObserver(entries => {\n        let updateQueued = false;\n\n        for (const { target: resizeTarget } of entries) {\n          // Ignore the first ResizeObserver event for each element since ResizeObserver always fires once when calling .observe().\n          if (!observedSet.has(resizeTarget)) {\n            observedSet.add(resizeTarget);\n          } else if (!updateQueued) {\n            updateQueued = true;\n\n            if (!ac.signal.aborted) {\n              forceUpdateRef.current?.();\n            }\n          }\n        }\n      })\n  );\n\n  useEffect(() => {\n    return () => {\n      ac.abort();\n      ro.disconnect();\n    };\n  }, []);\n\n  useEffect(() => {\n    if (!popperEl) return;\n\n    ro.observe(popperEl);\n\n    return () => {\n      ro.unobserve(popperEl);\n    };\n  }, [popperEl]);\n\n  useEffect(() => {\n    if (!resolvedTarget) return;\n\n    ro.observe(resolvedTarget);\n\n    return () => {\n      ro.unobserve(resolvedTarget);\n    };\n  }, [resolvedTarget]);\n\n  useLayoutEffect(() => {\n    if (resolvedTarget) {\n      initialOffset.current = getRelativeOffset(resolvedTarget, document.documentElement);\n    } else {\n      initialOffset.current = null;\n    }\n  }, [resolvedTarget]);\n\n  useEffect(() => {\n    if (!showPopover || !resolvedTarget) return;\n\n    let rafId: ReturnType<typeof requestAnimationFrame>;\n\n    const checkCoords = () => {\n      if (resolvedTarget && initialOffset.current) {\n        const newOffset = getRelativeOffset(resolvedTarget, document.documentElement);\n\n        if (initialOffset.current.x !== newOffset.x || initialOffset.current.y !== newOffset.y) {\n          initialOffset.current = newOffset;\n          forceUpdateRef.current?.();\n        } else {\n          rafId = requestAnimationFrame(checkCoords);\n        }\n      }\n    };\n\n    rafId = requestAnimationFrame(checkCoords);\n\n    return () => {\n      cancelAnimationFrame(rafId);\n    };\n  }, [showPopover, resolvedTarget]);\n\n  useEffect(() => {\n    if (groupId && show) setActive(uid, groupId);\n\n    if (windowIsAvailable) {\n      if (timeout.current) clearTimeout(timeout.current);\n      timeout.current = window.setTimeout(() => {\n        setShowPopover(show);\n      }, delays[show ? showDelay : hideDelay]);\n    } else {\n      setShowPopover(show);\n    }\n  }, [show]);\n\n  useEffect(() => {\n    return () => clearTimeout(timeout.current);\n  }, []);\n\n  useAfterInitialEffect(() => {\n    if (!showPopover) {\n      onHide?.();\n    }\n  }, [showPopover]);\n\n  useEffect(() => {\n    if (groupId && popovers[groupId] && popovers[groupId] !== uid) {\n      setShowPopover(false);\n    }\n  }, [groupId ? popovers[groupId] : undefined]);\n\n  useEffect(() => {\n    if (!portal || !resolvedTarget) return;\n\n    if (!popoverMap.has(resolvedTarget)) {\n      popoverMap.set(resolvedTarget, new Set());\n    }\n\n    resolvedTarget.toggleAttribute('data-popover-target', true);\n\n    popoverMap.get(resolvedTarget)!.add(pointerId);\n\n    return () => {\n      if (!popoverMap.has(resolvedTarget)) return;\n\n      popoverMap.get(resolvedTarget)!.delete(pointerId);\n\n      if (popoverMap.get(resolvedTarget)!.size === 0) {\n        popoverMap.delete(resolvedTarget);\n        resolvedTarget.removeAttribute('data-popover-target');\n      }\n    };\n  }, [portal, resolvedTarget, pointerId]);\n\n  const content = (\n    <StyledPopover\n      {...restProps}\n      data-popover-id={pointerId}\n      portal={!!(portal && portalTarget)}\n      offset={offset}\n      ref={popperRef}\n      style={{ ...style, ...styles.popper }}\n      {...attributes.popper}\n    >\n      {arrow && <StyledPopoverArrow ref={arrowRef} style={{ ...styles.arrow }} />}\n      {children}\n    </StyledPopover>\n  );\n\n  if (!target || !showPopover || (groupId && !checkActive(uid, groupId))) return null;\n\n  return portal && portalTarget ? createPortal(content, portalTarget) : content;\n});\n\nexport default Popover;\n"]}