{"version":3,"file":"MenuButton.js","sourceRoot":"","sources":["../../../src/components/MenuButton/MenuButton.tsx"],"names":[],"mappings":"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","sourcesContent":["import {\n  forwardRef,\n  useState,\n  FunctionComponent,\n  MouseEventHandler,\n  MouseEvent,\n  UIEvent,\n  PropsWithoutRef,\n  useCallback,\n  KeyboardEventHandler\n} from 'react';\nimport styled, { css } from 'styled-components';\n\nimport type { BaseProps, ForwardProps, NoChildrenProp, OmitStrict, TestIdProp } from '../../types';\nimport { defaultThemeProp } from '../../theme';\nimport {\n  useConsolidatedRef,\n  useUID,\n  useFocusWithin,\n  useDirection,\n  useTestIds,\n  useEscape\n} from '../../hooks';\nimport Button, { ButtonProps, StyledButton } from '../Button';\nimport Popover, { PopoverProps, StyledPopover } from '../Popover';\nimport Menu from '../Menu';\nimport { AcceptedMouseEventElement } from '../Menu/Menu.types';\nimport Icon, { registerIcon, StyledIcon } from '../Icon';\nimport * as arrowMicroDownIcon from '../Icon/icons/arrow-micro-down.icon';\nimport Text, { StyledText } from '../Text';\nimport Flex from '../Flex';\nimport { Count } from '../Badges';\nimport type { MenuProps } from '../Menu/Menu.types';\nimport type { CountProps } from '../Badges/Count';\nimport { withTestIds } from '../../utils';\n\nimport { getMenuButtonTestIds } from './MenuButton.test-ids';\n\nregisterIcon(arrowMicroDownIcon);\n\nexport interface MenuButtonProps extends BaseProps, NoChildrenProp, TestIdProp {\n  /** The text for the MenuButton also used to set the aria-label. */\n  text: string;\n  /**\n   * Determines the Button variant for the MenuButton.\n   * @default 'secondary'\n   */\n  variant?: ButtonProps['variant'];\n  /** The name of the icon for the MenuButton. */\n  icon?: string;\n  /** Only display the icon. The text prop will be forwarded to a tooltip. */\n  iconOnly?: ButtonProps['icon'];\n  /** The total count representing the list data which was selected. */\n  count?: CountProps['children'];\n  /** The click handler for the MenuButton. */\n  onClick?: MouseEventHandler;\n  /** Menu related props. */\n  menu?: MenuProps;\n  /** Popover related props. */\n  popover?: OmitStrict<PopoverProps, 'show' | 'target' | 'children'>;\n  /** DOM id for the button element. */\n  id?: string;\n  /** Ref for the button element. */\n  ref?: ButtonProps['ref'];\n  /** The keydown handler for the MenuButton. */\n  onKeyDown?: KeyboardEventHandler;\n}\n\nconst StyledMenuButton = styled.button(\n  ({\n    theme: {\n      base: { spacing }\n    }\n  }) => {\n    return css`\n      gap: ${spacing};\n      flex-shrink: 0;\n      white-space: nowrap;\n      max-width: 100%;\n\n      & + ${StyledPopover} + ${StyledButton} {\n        margin-inline-start: ${spacing};\n      }\n    `;\n  }\n);\n\nStyledMenuButton.defaultProps = defaultThemeProp;\n\nconst StyledMenuButtonChildren = styled.div(({ theme }) => {\n  return css`\n    max-width: 100%;\n\n    ${StyledText} {\n      text-overflow: ellipsis;\n      overflow: hidden;\n    }\n\n    ${StyledIcon}:last-child:not(:first-child) {\n      /* Offsets the flex gap to make the down arrow appear to trail the text. */\n      margin-inline-start: -${theme.base.spacing};\n    }\n  `;\n});\n\nconst StyledMenuButtonPopover = styled(Popover)`\n  min-width: 20ch;\n`;\n\nconst MenuButton: FunctionComponent<ForwardProps & MenuButtonProps> = forwardRef(\n  function MenuButton(props: PropsWithoutRef<MenuButtonProps>, ref: MenuButtonProps['ref']) {\n    const uid = useUID();\n    const {\n      testId,\n      id = uid,\n      text,\n      menu,\n      popover,\n      onClick,\n      onKeyDown,\n      icon,\n      count,\n      iconOnly = false,\n      ...restProps\n    } = props;\n    const testIds = useTestIds(testId, getMenuButtonTestIds);\n    const [isOpen, setIsOpen] = useState(false);\n\n    const buttonRef = useConsolidatedRef(ref);\n    const popoverRef = useConsolidatedRef<HTMLDivElement>(popover?.ref);\n    const menuRef = useConsolidatedRef<HTMLDivElement>(menu?.ref);\n\n    // FIXME: Type assertion required for issue in useFocusWithin generic\n    useFocusWithin<HTMLElement>(\n      [popoverRef, buttonRef],\n      useCallback(isFocused => {\n        if (!isFocused) setIsOpen(false);\n      }, [])\n    );\n\n    useEscape(e => {\n      if (isOpen) {\n        setIsOpen(false);\n        e.stopPropagation();\n      }\n    }, buttonRef);\n\n    const { rtl } = useDirection();\n\n    return (\n      <>\n        <Button\n          data-testid={testIds.root}\n          as={StyledMenuButton}\n          aria-label={text}\n          {...restProps}\n          id={id}\n          ref={buttonRef}\n          aria-expanded={isOpen}\n          aria-haspopup='menu'\n          aria-controls={`${id}-popover`}\n          label={iconOnly && !isOpen ? text : undefined}\n          onClick={(e: MouseEvent<HTMLButtonElement> & UIEvent<HTMLButtonElement>) => {\n            // clickCount is 0 when triggered by keyboard.\n            const clickCount = e.detail;\n\n            // Close the menu if it is open and either:\n            //   It is a *mouse* click on the button.\n            //   Or, the menu mode is not multiselect.\n            if (isOpen && (clickCount > 0 || menu?.mode !== 'multi-select')) {\n              setIsOpen(false);\n            } else {\n              setIsOpen(true);\n            }\n\n            onClick?.(e);\n          }}\n          icon={iconOnly}\n        >\n          <Flex as={StyledMenuButtonChildren} container={{ alignItems: 'center', gap: 1 }}>\n            {icon && <Icon name={icon} />}\n            {!iconOnly && (\n              <>\n                {text && <Text>{text}</Text>}\n                {typeof count === 'number' && <Count>{count}</Count>}\n                {text && <Icon name='arrow-micro-down' />}\n              </>\n            )}\n          </Flex>\n        </Button>\n        <StyledMenuButtonPopover\n          placement={rtl ? 'bottom-end' : 'bottom-start'}\n          hideOnTargetHidden\n          {...popover}\n          id={`${id}-popover`}\n          show={!!menu && isOpen}\n          target={buttonRef.current}\n          ref={popoverRef}\n        >\n          {menu && (\n            <Menu\n              testId={testIds.root}\n              {...menu}\n              ref={menuRef}\n              items={menu.items}\n              onItemClick={(itemId, e) => {\n                if (\n                  menu.mode !== 'multi-select' &&\n                  (e as MouseEvent<AcceptedMouseEventElement> & UIEvent<AcceptedMouseEventElement>)\n                    .detail > 0\n                ) {\n                  setIsOpen(false);\n                }\n                menu.onItemClick?.(itemId, e);\n              }}\n              focusControlEl={buttonRef.current || undefined}\n            />\n          )}\n        </StyledMenuButtonPopover>\n      </>\n    );\n  }\n);\n\nexport default withTestIds(MenuButton, getMenuButtonTestIds);\n"]}