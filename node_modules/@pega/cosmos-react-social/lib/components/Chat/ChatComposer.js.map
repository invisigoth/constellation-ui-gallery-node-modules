{"version":3,"file":"ChatComposer.js","sourceRoot":"","sources":["../../../src/components/Chat/ChatComposer.tsx"],"names":[],"mappings":"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","sourcesContent":["import {\n  forwardRef,\n  FunctionComponent,\n  Ref,\n  PropsWithoutRef,\n  ReactNode,\n  useState,\n  useEffect,\n  useCallback,\n  ChangeEvent,\n  useImperativeHandle,\n  useRef,\n  RefObject,\n  KeyboardEvent\n} from 'react';\nimport styled, { css } from 'styled-components';\n\nimport {\n  Flex,\n  TextArea,\n  Button,\n  Icon,\n  registerIcon,\n  Popover,\n  EmojiPicker,\n  EmojiPickerProps,\n  hasProp,\n  useI18n,\n  useElement,\n  defaultThemeProp,\n  PropsWithDefaults,\n  ForwardProps,\n  Tooltip,\n  useOuterEvent,\n  VisuallyHiddenText,\n  FileUploadItem,\n  FileUploadItemProps,\n  Grid\n} from '@pega/cosmos-react-core';\nimport BareButton from '@pega/cosmos-react-core/lib/components/Button/BareButton';\nimport * as timesIcon from '@pega/cosmos-react-core/lib/components/Icon/icons/times.icon';\nimport * as faceHappyIcon from '@pega/cosmos-react-core/lib/components/Icon/icons/face-happy.icon';\nimport * as paperClipIcon from '@pega/cosmos-react-core/lib/components/Icon/icons/paper-clip.icon';\n\nregisterIcon(timesIcon, faceHappyIcon, paperClipIcon);\n\nexport type SpecialKeysConfig = {\n  /** Collection of specialKeys */\n  keys: string[];\n  /** onSpecialKey is fired when a special key is typed in Textarea */\n  onSpecialKey: (e: KeyboardEvent<HTMLTextAreaElement>, key: string) => void;\n};\n\nexport interface ChatComposerProps {\n  /** Place holder */\n  placeholder?: string;\n  /** Default message to populate on load */\n  defaultMessage?: string;\n  /** Max character limit */\n  maxLength?: number;\n  /** Callback when send button is clicked */\n  onSend: (message: string) => void;\n  /** Enter / Return key sends message */\n  enterKeySendsMessage?: boolean;\n  /** Max number of attachments to be allowed in chat composer.\n   * If zero is passed, add attachments icon will be hidden. same rule applies if prop is not passed.\n   * If attachments added are >= maxAttachments, add attachments icon will be disabled.\n   */\n  maxAttachments?: number;\n  /** show/hide emoji */\n  showEmoji?: boolean;\n  /** Attachments list */\n  attachments?: FileUploadItemProps[];\n  /** Callback when attachment icon is clicked */\n  onAddAttachment?: () => void;\n  /** Special Keys configuration */\n  specialKeysConfig?: SpecialKeysConfig;\n  /** Disables the composer area */\n  disabled?: boolean;\n  /** Children */\n  children?: ReactNode;\n  /** Ref to the Imperative handle */\n  ref?: Ref<ChatComposerImperativeHandleProps>;\n}\n\nconst StyledAttachmentItem = styled(FileUploadItem)``;\n\ninterface DisableAttachmentProps {\n  disabled?: boolean;\n}\nconst StyledAttachmentElementContainer = styled.div<DisableAttachmentProps>(\n  ({ disabled, theme }) => {\n    return (\n      disabled &&\n      css`\n        &:focus {\n          box-shadow: ${theme.base.shadow.focus};\n          border-radius: 50%;\n          outline: none;\n        }\n      `\n    );\n  }\n);\nconst StyledPreviewButton = styled(BareButton)``;\nconst StyledDeleteButton = styled(BareButton)``;\n\nconst StyledChatComposer = styled.footer<PropsWithDefaults<ChatComposerProps, 'disabled'>>(\n  ({\n    theme,\n    disabled,\n    theme: {\n      base: { 'disabled-opacity': transparentBg, spacing }\n    }\n  }) => {\n    return css`\n      padding: calc(2 * ${spacing});\n      background-color: ${theme.base.palette['secondary-background']};\n      border-end-start-radius: inherit;\n      border-end-end-radius: inherit;\n      textarea {\n        border-radius: ${theme.base['border-radius']};\n        height: 5rem;\n        border: 0.0625rem solid ${theme.base.colors.gray['extra-light']};\n        max-width: 100%;\n      }\n      ${StyledAttachmentItem} {\n        ${disabled &&\n        css`\n          pointer-events: none;\n          opacity: ${transparentBg};\n        `}\n      }\n\n      ${StyledAttachmentElementContainer} {\n        ${disabled &&\n        css`\n          pointer-events: none;\n        `}\n      }\n\n      ${StyledPreviewButton} {\n        color: ${theme.base.palette.interactive};\n        font-weight: bold;\n        &:hover {\n          text-decoration: underline;\n        }\n      }\n\n      ${StyledDeleteButton} {\n        color: ${theme.base.palette.interactive};\n      }\n    `;\n  }\n);\n\nStyledChatComposer.defaultProps = defaultThemeProp;\nStyledAttachmentElementContainer.defaultProps = defaultThemeProp;\n\nexport const StyledAttachmentsListContainer = styled.div(({ theme }) => {\n  return css`\n    max-height: 5rem;\n    overflow-y: auto;\n\n    &:focus-within {\n      box-shadow: ${theme.base.shadow['focus-group']};\n      border-radius: calc(0.5 * ${theme.base['border-radius']});\n    }\n  `;\n});\n\nexport interface ChatComposerImperativeHandleProps {\n  /** Function to append a message */\n  appendToMessage: (\n    appendMessage: string,\n    position?: 'cursor' | 'start' | 'end' | 'specialKey'\n  ) => void;\n  /** Actual ref to Chat composer component */\n  chatComposerRef: RefObject<HTMLDivElement | undefined>;\n  textAreaRef: RefObject<HTMLTextAreaElement | undefined>;\n}\n\nconst ChatComposer: FunctionComponent<ChatComposerProps & ForwardProps> = forwardRef(\n  function ChatComposer(props: PropsWithoutRef<ChatComposerProps>, ref: ChatComposerProps['ref']) {\n    const {\n      children,\n      attachments = [],\n      maxAttachments = 0,\n      onAddAttachment,\n      maxLength,\n      placeholder: defaultPlaceHolder,\n      defaultMessage = '',\n      onSend,\n      specialKeysConfig,\n      disabled = false,\n      enterKeySendsMessage = true,\n      showEmoji,\n      ...restProps\n    } = props;\n    const [message, setMessage] = useState(defaultMessage);\n    useEffect(() => {\n      setMessage(defaultMessage);\n    }, [defaultMessage]);\n\n    const t = useI18n();\n\n    const textAreaRef = useRef<HTMLTextAreaElement>(null);\n    const [showEmojiPicker, setShowEmojiPicker] = useState(false);\n    const [emojiBtnEl, setEmojiBtnEl] = useElement();\n    const [attachmentsBtnEl, setAttachmentsBtnEl] = useElement();\n    const [announcement, setAnnouncement] = useState('');\n\n    const lastEnteredSpecialKey = useRef<string | null>(null);\n\n    const appendToMessage = useCallback(\n      (\n        appendMessage: string,\n        position?: 'cursor' | 'start' | 'end' | 'specialKey',\n        selectText: boolean = true\n      ) => {\n        let selectionStart;\n        let selectionEnd;\n        if (textAreaRef.current) {\n          if (position === 'start') {\n            textAreaRef.current.value = appendMessage + textAreaRef.current.value;\n            selectionStart = 0;\n            selectionEnd = appendMessage.length;\n          } else if (position === 'end') {\n            const initialEnd = textAreaRef.current.value.length;\n            textAreaRef.current.value += appendMessage;\n            selectionStart = initialEnd;\n            selectionEnd = initialEnd + appendMessage.length;\n          } else if (position === 'specialKey' && lastEnteredSpecialKey.current) {\n            const replaceChars = lastEnteredSpecialKey.current.length;\n            const currentSelectionStart = textAreaRef.current.selectionStart;\n            textAreaRef.current.value =\n              textAreaRef.current.value.substring(\n                0,\n                textAreaRef.current.selectionStart - replaceChars\n              ) +\n              appendMessage +\n              textAreaRef.current.value.substring(\n                textAreaRef.current.selectionStart,\n                textAreaRef.current.value.length\n              );\n            selectionStart = currentSelectionStart - replaceChars;\n            selectionEnd = currentSelectionStart + appendMessage.length - replaceChars;\n            lastEnteredSpecialKey.current = null;\n          } else {\n            const currentSelectionStart = textAreaRef.current.selectionStart;\n            textAreaRef.current.value =\n              textAreaRef.current.value.substring(0, textAreaRef.current.selectionStart) +\n              appendMessage +\n              textAreaRef.current.value.substring(\n                textAreaRef.current.selectionStart,\n                textAreaRef.current.value.length\n              );\n            selectionStart = currentSelectionStart;\n            selectionEnd = currentSelectionStart + appendMessage.length;\n          }\n          textAreaRef.current.selectionStart = selectText ? selectionStart : selectionEnd;\n          textAreaRef.current.selectionEnd = selectionEnd;\n          textAreaRef.current.focus();\n          setMessage(textAreaRef.current.value);\n        }\n      },\n      [setMessage, textAreaRef.current]\n    );\n\n    const chatComposerRef = useRef<HTMLDivElement>(null);\n\n    useImperativeHandle(ref, () => ({ appendToMessage, chatComposerRef, textAreaRef }), [\n      appendToMessage,\n      chatComposerRef.current,\n      textAreaRef.current\n    ]);\n\n    const sendMessage = useCallback(\n      (newMessage: string) => {\n        if (onSend) {\n          onSend(newMessage);\n          setMessage('');\n        }\n      },\n      [onSend]\n    );\n\n    const handleEnterKeyDown = useCallback(\n      (e: KeyboardEvent) => {\n        if (enterKeySendsMessage && e.keyCode === 13 && !e.shiftKey) {\n          if (!maxLength || message.length <= maxLength) {\n            sendMessage(message);\n            setAnnouncement(t('message_sent'));\n          }\n          e.preventDefault();\n          e.stopPropagation();\n        }\n      },\n      [onSend, message, maxLength]\n    );\n\n    const handleTextAreaChange = useCallback(\n      (e: ChangeEvent<HTMLTextAreaElement>) => {\n        setMessage(e.currentTarget.value);\n        setAnnouncement('');\n      },\n      [setMessage]\n    );\n\n    const handleSpecialKey = useCallback(\n      (e: KeyboardEvent<HTMLTextAreaElement>) => {\n        if (!specialKeysConfig) return;\n        const { keys, onSpecialKey } = specialKeysConfig;\n        if (specialKeysConfig && keys.length > 0) {\n          const composerValue = e.currentTarget.value.substring(0, e.currentTarget.selectionStart);\n          const specialKey = keys.find(key => composerValue.endsWith(key));\n          if (specialKey) {\n            lastEnteredSpecialKey.current = specialKey;\n            onSpecialKey(e, specialKey);\n          }\n        }\n      },\n      [specialKeysConfig]\n    );\n\n    const toggleEmoji = () => {\n      setShowEmojiPicker(!showEmojiPicker);\n    };\n    const onEmojiSelect: EmojiPickerProps['onSelect'] = emojiElem => {\n      // Check that it is not a custom emoji\n      if (hasProp(emojiElem, 'native')) {\n        appendToMessage(emojiElem.native, 'cursor', false);\n      }\n      setShowEmojiPicker(false);\n    };\n\n    const EmojiPickerRef = useRef<HTMLDivElement>(null);\n\n    useOuterEvent('mousedown', [emojiBtnEl, EmojiPickerRef], () => {\n      setShowEmojiPicker(false);\n    });\n\n    return (\n      <>\n        <Flex\n          as={StyledChatComposer}\n          disabled={disabled}\n          container={{\n            direction: 'column',\n            gap: 2\n          }}\n          item={{\n            shrink: 0\n          }}\n          {...restProps}\n          ref={chatComposerRef}\n        >\n          <Flex\n            container={{\n              direction: 'column',\n              gap: 0.5\n            }}\n          >\n            <Grid\n              container={{\n                cols: 'repeat(auto-fill, minmax(12rem, 1fr))',\n                gap: 1\n              }}\n              role='group'\n              aria-label={`${t('attachments')}`}\n              as={StyledAttachmentsListContainer}\n            >\n              {attachments.map((attachment, idx) => {\n                if (disabled) {\n                  const attachmentProps = {\n                    ...attachment,\n                    onDelete: undefined,\n                    onDownload: undefined,\n                    onPreview: undefined,\n                    onEdit: undefined,\n                    onCancel: undefined\n                  };\n                  return <StyledAttachmentItem {...attachmentProps} key={attachmentProps.name} />;\n                }\n                return (\n                  <div\n                    aria-label={`${t('attachments_x_of_y', [idx + 1, attachments.length])}`}\n                    key={attachment.name}\n                  >\n                    <StyledAttachmentItem {...attachment} />\n                  </div>\n                );\n              })}\n            </Grid>\n            <TextArea\n              ref={textAreaRef}\n              maxLength={maxLength}\n              displayCharCount={maxLength !== undefined}\n              hardStop={false}\n              placeholder={defaultPlaceHolder}\n              value={message}\n              disabled={disabled}\n              onKeyUp={handleSpecialKey}\n              onKeyDown={handleEnterKeyDown}\n              onChange={handleTextAreaChange}\n              onFocus={handleTextAreaChange}\n              aria-label={t('enter_message')}\n              autoResize={false}\n            />\n          </Flex>\n          <Flex container={{ gap: 0.5 }}>\n            {showEmoji && (\n              <Button\n                ref={setEmojiBtnEl}\n                onClick={toggleEmoji}\n                variant='simple'\n                disabled={disabled}\n                icon\n                aria-label={t('add_emoji')}\n              >\n                <Icon name='face-happy' />\n              </Button>\n            )}\n            {maxAttachments > 0 && (\n              <StyledAttachmentElementContainer\n                disabled={attachments.length >= maxAttachments}\n                ref={setAttachmentsBtnEl}\n                tabIndex={attachments.length >= maxAttachments ? 0 : undefined}\n                role='button'\n              >\n                <Button\n                  onClick={onAddAttachment}\n                  variant='simple'\n                  disabled={!!(disabled || attachments.length >= maxAttachments)}\n                  icon\n                  aria-label={\n                    attachments.length >= maxAttachments\n                      ? t('email_disable_attachment', [maxAttachments])\n                      : t('email_add_attachment', [maxAttachments])\n                  }\n                >\n                  <Icon name='paper-clip' />\n                </Button>\n                {attachments.length >= maxAttachments && (\n                  <Tooltip\n                    target={attachmentsBtnEl}\n                    showDelay='none'\n                    hideDelay='none'\n                    {...restProps}\n                  >\n                    {t('email_disable_attachment', [maxAttachments])}\n                  </Tooltip>\n                )}\n              </StyledAttachmentElementContainer>\n            )}\n            <Flex item={{ grow: 1 }}>{children}</Flex>\n            <Button\n              variant='primary'\n              disabled={disabled || (!!maxLength && message.length > maxLength)}\n              onClick={() => {\n                sendMessage(message);\n                setAnnouncement(t('message_sent'));\n              }}\n            >\n              {t('send')}\n            </Button>\n            {announcement && (\n              <VisuallyHiddenText aria-live='assertive'>{announcement}</VisuallyHiddenText>\n            )}\n          </Flex>\n        </Flex>\n        <Popover\n          show={showEmojiPicker}\n          target={emojiBtnEl}\n          placement='top-start'\n          modifiers={[\n            {\n              name: 'flip',\n              enabled: true\n            }\n          ]}\n        >\n          <EmojiPicker ref={EmojiPickerRef} onSelect={onEmojiSelect} />\n        </Popover>\n      </>\n    );\n  }\n);\n\nexport default ChatComposer;\n"]}