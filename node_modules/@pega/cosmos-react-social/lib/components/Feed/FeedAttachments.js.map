{"version":3,"file":"FeedAttachments.js","sourceRoot":"","sources":["../../../src/components/Feed/FeedAttachments.tsx"],"names":[],"mappings":"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","sourcesContent":["import { FC, forwardRef, PropsWithoutRef, useEffect, useContext } from 'react';\nimport styled, { css } from 'styled-components';\n\nimport {\n  FileUploadItem,\n  Grid,\n  Image,\n  defaultThemeProp,\n  getKindFromMimeType,\n  getMimeTypeFromFile,\n  Flex,\n  usePrevious,\n  useI18n\n} from '@pega/cosmos-react-core';\nimport BareButton from '@pega/cosmos-react-core/lib/components/Button/BareButton';\n\nimport { FeedContext } from './Feed.context';\nimport { AttachedFiles, FeedAttachmentsProps } from './Feed.types';\n\nexport const StyledFeedAttachments = styled.ul(({ theme }) => {\n  return css`\n    overflow-x: auto;\n\n    > li {\n      background-color: ${theme.base.palette['primary-background']};\n      cursor: initial;\n    }\n  `;\n});\n\nStyledFeedAttachments.defaultProps = defaultThemeProp;\n\nexport const StyledImagePreview = styled(BareButton)(({ theme }) => {\n  return css`\n    line-height: 0;\n    width: fit-content;\n    border-radius: calc(0.5 * ${theme.base['border-radius']});\n\n    & + & {\n      margin: 0;\n    }\n\n    &:focus {\n      box-shadow: ${theme.components.button['focus-shadow']};\n    }\n\n    img {\n      border-radius: calc(0.5 * ${theme.base['border-radius']});\n      object-fit: contain;\n      max-height: 10rem;\n      max-width: 100%;\n    }\n  `;\n});\n\nStyledImagePreview.defaultProps = defaultThemeProp;\n\nexport const StyledAttachmentsRegion = styled.div<FeedAttachmentsProps>(\n  ({ variant, readOnly, theme }) => {\n    return css`\n      margin: ${theme.base.spacing} calc(5 * ${theme.base.spacing}) 0\n        calc(${variant === 'post' ? 6 : 5} * ${theme.base.spacing});\n\n      ${readOnly &&\n      css`\n        margin-block-start: ${theme.base.spacing};\n        margin-inline: 0;\n\n        div + ul {\n          margin-block-start: ${theme.base.spacing};\n        }\n      `}\n    `;\n  }\n);\n\nStyledAttachmentsRegion.defaultProps = defaultThemeProp;\n\nconst FeedAttachments: FC<FeedAttachmentsProps> = forwardRef(function FeedAttachments(\n  props: PropsWithoutRef<FeedAttachmentsProps>,\n  ref: FeedAttachmentsProps['ref']\n) {\n  const { variant, attachments = [], readOnly } = props;\n  const t = useI18n();\n  const { announce } = useContext(FeedContext);\n  const prevAttachments = usePrevious(attachments) ?? [];\n\n  useEffect(() => {\n    if (!readOnly && attachments.length !== prevAttachments?.length) {\n      const difference = attachments.length - prevAttachments.length;\n      const normalizedDifference = difference * (difference > 0 ? 1 : -1);\n      const timeoutId = announce(\n        t(`feed_attachments_${difference > 0 ? 'added' : 'removed'}`, [normalizedDifference], {\n          count: normalizedDifference\n        })\n      );\n      return () => clearTimeout(timeoutId);\n    }\n  }, [attachments, readOnly]);\n\n  if (attachments.length === 0) return null;\n\n  const previewableFiles: AttachedFiles[] = [];\n  const nonPreviewableFiles: AttachedFiles[] = [];\n\n  attachments.forEach(file => {\n    const type = getKindFromMimeType(getMimeTypeFromFile(file.name) ?? '');\n\n    if (type === 'image' && file.thumbnail) previewableFiles.push(file);\n    else nonPreviewableFiles.push(file);\n  });\n\n  return (\n    <StyledAttachmentsRegion variant={variant} readOnly={readOnly}>\n      {readOnly && !!previewableFiles.length && (\n        <Flex container={{ gap: 1, wrap: 'wrap' }}>\n          {previewableFiles.map(({ lastModified, name, onPreview, thumbnail }) => {\n            return (\n              <StyledImagePreview key={lastModified} onClick={() => onPreview?.(name)}>\n                <Image alt={name} src={thumbnail} />\n              </StyledImagePreview>\n            );\n          })}\n        </Flex>\n      )}\n      <Grid\n        ref={ref}\n        as={StyledFeedAttachments}\n        container={{\n          cols: 'repeat(auto-fill, minmax(15rem, 1fr))',\n          gap: 1\n        }}\n      >\n        {!readOnly &&\n          previewableFiles.map(({ lastModified, name, size, ...restProps }) => {\n            return <FileUploadItem key={lastModified} name={name} size={size} {...restProps} />;\n          })}\n        {nonPreviewableFiles.map(({ lastModified, name, size, ...restProps }) => {\n          return <FileUploadItem key={lastModified} name={name} size={size} {...restProps} />;\n        })}\n      </Grid>\n    </StyledAttachmentsRegion>\n  );\n});\n\nexport default FeedAttachments;\n"]}