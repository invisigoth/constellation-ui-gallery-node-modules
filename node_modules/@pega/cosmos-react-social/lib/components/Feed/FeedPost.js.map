{"version":3,"file":"FeedPost.js","sourceRoot":"","sources":["../../../src/components/Feed/FeedPost.tsx"],"names":[],"mappings":"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","sourcesContent":["import { FC, useState, useEffect, MutableRefObject, useRef, useContext, useMemo } from 'react';\nimport styled, { css } from 'styled-components';\n\nimport {\n  Button,\n  Card,\n  CardContent,\n  Flex,\n  registerIcon,\n  defaultThemeProp,\n  ForwardProps,\n  useI18n,\n  Progress,\n  usePrevious\n} from '@pega/cosmos-react-core';\nimport { RichTextEditorState } from '@pega/cosmos-react-rte';\nimport * as arrowMicroDownIcon from '@pega/cosmos-react-core/lib/components/Icon/icons/arrow-micro-down.icon';\nimport * as caretLeftIcon from '@pega/cosmos-react-core/lib/components/Icon/icons/caret-left.icon';\n\nimport FeedAttachments from './FeedAttachments';\nimport FeedContent from './FeedContent';\nimport FeedReplyInput, { StyledReplyInputContainer } from './FeedReplyInput';\nimport { FeedContext, FeedReplyContext } from './Feed.context';\nimport { FeedPostProps } from './Feed.types';\nimport FeedContentHeader from './FeedContentHeader';\nimport FeedContentFooter from './FeedContentFooter';\nimport FeedEditRegion from './FeedEditRegion';\nimport { StyledFeedReplyContainer } from './FeedReply';\n\nregisterIcon(arrowMicroDownIcon, caretLeftIcon);\n\nexport const StyledFeedPost = styled(Card)(\n  ({ theme }) => css`\n    margin-block-start: calc(2 * ${theme.base.spacing});\n  `\n);\n\nStyledFeedPost.defaultProps = defaultThemeProp;\n\nconst StyledPostContent = styled.div<{ showLines: boolean }>(({ showLines, theme }) => {\n  return css`\n    padding-inline-start: calc(6 * ${theme.base.spacing});\n\n    ${showLines &&\n    css`\n      margin-inline-start: calc(2.5 * ${theme.base.spacing});\n      border-inline-start: solid 0.0625rem ${theme.base.palette['border-line']};\n      padding-inline-start: calc(3.5 * ${theme.base.spacing});\n    `}\n  `;\n});\n\nStyledPostContent.defaultProps = defaultThemeProp;\n\nexport const StyledReplies = styled.div(\n  ({ theme }) => css`\n    margin-inline-start: calc(-1.75 * ${theme.base.spacing});\n\n    ${StyledFeedReplyContainer}, ${StyledReplyInputContainer} {\n      padding-block-start: ${theme.base.spacing};\n    }\n  `\n);\n\nStyledReplies.defaultProps = defaultThemeProp;\n\nconst FeedPost: FC<ForwardProps & FeedPostProps> = (props: ForwardProps & FeedPostProps) => {\n  const {\n    id,\n    avatarSrc,\n    fullname,\n    username,\n    postTimestamp,\n    content,\n    postType = 'public',\n    recipients,\n    recipientsCount,\n    attachments,\n    liked,\n    icon,\n    postContext,\n    userStatus,\n    likes,\n    likeCount,\n    interactionsEnabled,\n    maxContentHeight = Infinity,\n    onMouseEnter,\n    onMouseLeave,\n    onCommentClick,\n    onLikeClick,\n    onLikeCountInteraction,\n    likesLoading,\n    onLoadMoreLikes,\n    onRecipientInteraction,\n    recipientsLoading,\n    onLoadMoreRecipients,\n    onUserClick,\n    onShowMoreClick,\n    newReplyField,\n    menuItems,\n    onEditSubmit,\n    edited = false,\n    editTimestamp,\n    replies = [],\n    replyInput,\n    replyInputShown,\n    replyCount,\n    repliesLoading,\n    onShowLessReplies,\n    onShowMoreReplies,\n    ...restProps\n  } = props;\n  const { announce } = useContext(FeedContext);\n  const variant = 'post';\n\n  const t = useI18n();\n  const [editMode, setEditMode] = useState(false);\n  const [emptyEditText, setEmptyEditText] = useState(false);\n  const [replyInputOpen, setReplyInputOpen] = useState(false);\n  const [replyInputRef, setReplyInputRef] = useState<MutableRefObject<\n    RichTextEditorState | undefined\n  > | null>(null);\n  const prevReplies = usePrevious(replies);\n  const suppressNextAnnouncement = useRef(false);\n\n  useEffect(() => {\n    if ((replyInputOpen || replyInputShown) && replyInputRef) {\n      replyInputRef.current?.focus();\n    }\n  }, [replyInputOpen, replyInputShown, replyInputRef]);\n\n  const replyCtxValue = useMemo(() => ({ onShowReplyInput: () => setReplyInputOpen(true) }), []);\n\n  useEffect(() => {\n    if (prevReplies) {\n      const difference = prevReplies.length - replies.length;\n      if (difference > 0 && !suppressNextAnnouncement.current) {\n        const timeoutId = announce(t('feed_comment_removed'));\n        return () => clearTimeout(timeoutId);\n      }\n      suppressNextAnnouncement.current = false;\n    }\n  }, [replies]);\n\n  const hasReplies = !!replies?.length;\n\n  return (\n    <FeedReplyContext.Provider value={replyCtxValue}>\n      <StyledFeedPost\n        {...restProps}\n        onMouseEnter={() => {\n          onMouseEnter?.({ id });\n        }}\n        onMouseLeave={() => {\n          onMouseLeave?.({ id });\n        }}\n      >\n        <CardContent>\n          <FeedContentHeader\n            {...{\n              variant,\n              id,\n              fullname,\n              username,\n              postTimestamp,\n              content,\n              avatarSrc,\n              icon,\n              userStatus,\n              postType,\n              postContext,\n              recipients,\n              recipientsCount,\n              menuItems,\n              edited,\n              editTimestamp,\n              recipientsLoading,\n              onEditSubmit,\n              onLoadMoreRecipients,\n              onRecipientInteraction,\n              onUserClick,\n              setEditMode\n            }}\n          />\n          <StyledPostContent showLines={hasReplies || replyInputOpen}>\n            <Flex\n              container={{ direction: 'column', pad: [0, editMode ? 0 : 2, 0, 0] }}\n              item={{ grow: 1 }}\n            >\n              {editMode ? (\n                <FeedEditRegion\n                  {...{\n                    variant,\n                    id,\n                    content,\n                    setEditMode,\n                    onEditSubmit,\n                    emptyEditText,\n                    setEmptyEditText\n                  }}\n                />\n              ) : (\n                <FeedContent maxContentHeight={maxContentHeight}>{content}</FeedContent>\n              )}\n              <FeedAttachments variant={variant} attachments={attachments} readOnly />\n            </Flex>\n            <FeedContentFooter\n              {...{\n                variant,\n                id,\n                username,\n                liked,\n                likes,\n                likeCount,\n                interactionsEnabled,\n                likesLoading,\n                replies,\n                replyCount,\n                repliesLoading,\n                onCommentClick,\n                onLikeClick,\n                onLikeCountInteraction,\n                onLoadMoreLikes,\n                onShowMoreReplies,\n                onShowLessReplies,\n                replyInputOpen,\n                setReplyInputOpen\n              }}\n            />\n\n            <StyledReplies>\n              {hasReplies && replies}\n              {replyInputShown ||\n                (replyInputOpen && (\n                  <FeedReplyInput\n                    onSetInputRef={({ ref }) => {\n                      setReplyInputRef(ref);\n                    }}\n                    id={id}\n                    attachments={replyInput.attachments}\n                    onFilesAdded={replyInput.onFilesAdded}\n                    onSubmit={e => {\n                      setReplyInputOpen(false);\n                      replyInput.onSubmit(e);\n                    }}\n                  />\n                ))}\n            </StyledReplies>\n            {onShowLessReplies && !!replies.length && (\n              <Flex container={{ justify: 'center', pad: [0, 0, 1], gap: 1 }}>\n                <Button\n                  variant='link'\n                  onClick={() => {\n                    onShowLessReplies({ id });\n                    suppressNextAnnouncement.current = true;\n                  }}\n                >\n                  {t('show_less')}\n                </Button>\n                {repliesLoading && <Progress placement='inline' />}\n              </Flex>\n            )}\n          </StyledPostContent>\n        </CardContent>\n      </StyledFeedPost>\n    </FeedReplyContext.Provider>\n  );\n};\n\nexport default FeedPost;\n"]}