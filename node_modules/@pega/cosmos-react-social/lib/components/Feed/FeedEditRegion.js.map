{"version":3,"file":"FeedEditRegion.js","sourceRoot":"","sources":["../../../src/components/Feed/FeedEditRegion.tsx"],"names":[],"mappings":"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","sourcesContent":["import { FC, useContext, useEffect, useRef, useState } from 'react';\nimport styled, { css } from 'styled-components';\n\nimport {\n  Button,\n  defaultThemeProp,\n  Flex,\n  ForwardProps,\n  Icon,\n  useI18n,\n  useOuterEvent\n} from '@pega/cosmos-react-core';\nimport { RichTextEditorState } from '@pega/cosmos-react-rte';\n\nimport FeedRichText from './FeedRichText';\nimport { FeedEditRegionProps } from './Feed.types';\nimport { minInputHeight, StyledActions } from './FeedInputRegion';\nimport FeedButton from './FeedButton';\nimport { FeedContext } from './Feed.context';\n\nconst StyledInputContainer = styled.div(({ theme }) => {\n  return css`\n    width: calc(100% - (${theme.base.spacing} + ${theme.base['hit-area']['mouse-min']}));\n\n    @media (pointer: coarse) {\n      width: calc(100% - (${theme.base.spacing} + ${theme.base['hit-area']['finger-min']}));\n    }\n  `;\n});\n\nStyledInputContainer.defaultProps = defaultThemeProp;\n\nconst FeedEditRegion: FC<ForwardProps & FeedEditRegionProps> = (\n  props: ForwardProps & FeedEditRegionProps\n) => {\n  const { variant, id, content, setEditMode, onEditSubmit, emptyEditText, setEmptyEditText } =\n    props;\n\n  const t = useI18n();\n  const { setShowSearchResults } = useContext(FeedContext);\n  const rteRef = useRef<RichTextEditorState>();\n  const editTextAreaRef = useRef<HTMLDivElement>(null);\n\n  const [contentModified, setContentModified] = useState(false);\n\n  useOuterEvent('mousedown', [editTextAreaRef], () => {\n    if (emptyEditText) setEditMode(false);\n  });\n\n  const handleEdit = () => {\n    setShowSearchResults?.(false);\n    if (!emptyEditText && contentModified) {\n      onEditSubmit?.({\n        id,\n        value: rteRef.current?.getPlainText() || ''\n      });\n      setEditMode(false);\n    }\n  };\n\n  const onKeyDown = (event: KeyboardEvent) => {\n    setShowSearchResults?.(true);\n    if ((event.metaKey || event.ctrlKey) && event.key === 'Enter') handleEdit();\n  };\n\n  useEffect(() => {\n    if (rteRef.current) {\n      rteRef.current?.focus();\n    }\n  }, [rteRef]);\n\n  const label = t(variant === 'post' ? 'feed_edit_post' : 'feed_edit_comment');\n\n  return (\n    <Flex container={{ gap: 1, alignItems: 'start' }}>\n      <StyledInputContainer ref={editTextAreaRef}>\n        <FeedRichText\n          label={label}\n          onChange={() => {\n            setEmptyEditText(rteRef.current?.getPlainText().trim() === '');\n            setContentModified(rteRef.current?.getPlainText() !== content);\n          }}\n          onKeyDown={onKeyDown}\n          height={{ min: minInputHeight }}\n          defaultValue={content}\n          ref={rteRef}\n        />\n      </StyledInputContainer>\n      <Flex as={StyledActions} container={{ direction: 'column', gap: 0.25 }}>\n        <Button\n          variant='simple'\n          as={FeedButton}\n          onClick={() => setEditMode(false)}\n          icon\n          label={t('cancel')}\n        >\n          <Icon name='times' />\n        </Button>\n\n        <Button\n          as={FeedButton}\n          disabled={emptyEditText || !contentModified}\n          variant='simple'\n          onClick={handleEdit}\n          icon\n          label={t('update')}\n        >\n          <Icon name='send' />\n        </Button>\n      </Flex>\n    </Flex>\n  );\n};\n\nexport default FeedEditRegion;\n"]}