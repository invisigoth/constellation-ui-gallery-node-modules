{"version":3,"file":"DynamicContentEditor.js","sourceRoot":"","sources":["../../../src/components/DynamicContentEditor/DynamicContentEditor.tsx"],"names":[],"mappings":"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","sourcesContent":["import { forwardRef, FunctionComponent, PropsWithoutRef, useRef, useEffect, useState } from 'react';\nimport styled from 'styled-components';\nimport { Bookmark, Editor as TinyMCEEditor, EditorSelection } from 'tinymce';\n\nimport {\n  Button,\n  defaultThemeProp,\n  ForwardProps,\n  Menu,\n  menuHelpers,\n  Modal,\n  ModalMethods,\n  Popover,\n  PropsWithDefaults,\n  StyledPopover,\n  useModalManager,\n  useConsolidatedRef,\n  useI18n,\n  useUID\n} from '@pega/cosmos-react-core';\nimport { getKeyCommand } from '@pega/cosmos-react-rte/lib/components/RichTextEditor/Toolbar/utils';\n\nimport { Editor, EditorProps } from '../Editor';\n\nimport {\n  DynamicContentEditorProps,\n  FieldItems,\n  ItemType,\n  isFieldMenuItem\n} from './DynamicContentEditor.types';\nimport { pegaReferenceElementStyle, createPegaReferenceElement } from './PegaCustomElement';\n\ntype DynamicContentEditorPropsWithDefaults = PropsWithDefaults<DynamicContentEditorProps>;\n\nconst StyledDynamicContentEditor = styled.div<DynamicContentEditorPropsWithDefaults>``;\n\nexport const StyledSearchPopover = styled(StyledPopover)`\n  min-width: 20rem;\n`;\n\nStyledDynamicContentEditor.defaultProps = defaultThemeProp;\n\nconst DynamicContentEditor: FunctionComponent<DynamicContentEditorProps & ForwardProps> =\n  forwardRef(function DynamicContentEditor(\n    {\n      form: { dynamicContentPicker, onSubmit },\n      onActiveFieldChange,\n      label,\n      toolbar,\n      fieldItems,\n      defaultValue,\n      onBlur,\n      ...restProps\n    }: PropsWithoutRef<DynamicContentEditorProps>,\n    ref: DynamicContentEditorProps['ref']\n  ) {\n    const menuID = useUID();\n    const { create } = useModalManager();\n    const t = useI18n();\n\n    const modalMethods = useRef<ModalMethods>();\n    const [editor, setEditor] = useState<TinyMCEEditor | undefined>();\n    const [bookmark, setBookmark] = useState<Bookmark | undefined>();\n    const [fieldMenuItems, setFieldMenuItems] = useState<FieldItems[]>(fieldItems || []);\n    const [currentElementId, setCurrentElementId] = useState('');\n    const [currentElementContent, setCurrentElementContent] = useState('');\n    const [currentElementNamespace, setCurrentElementNamespace] = useState('');\n    const [currentCursorPosition, setCurrentCursorPosition] = useState({\n      bottom: 0,\n      height: 0,\n      left: 0,\n      right: 0,\n      top: 0,\n      width: 0,\n      x: 0,\n      y: 0,\n      toJSON: () => {}\n    });\n    const [showFieldsPopover, setShowFieldsPopover] = useState<boolean>(false);\n\n    const fieldPopoverRef = useRef<HTMLDivElement>(null);\n    const editorRef = useConsolidatedRef(ref);\n\n    const tooltip = getKeyCommand(\n      navigator.appVersion.includes('Mac'),\n      ({ ctrl }) => `${t('rte_insert_field')} (${ctrl}/)`\n    );\n\n    const insertField = (field: ItemType) => {\n      if (!editor) return;\n\n      const fieldContent = `<pega-reference role=\"button\" contenteditable=\"false\" data-rule-type='field' data-rule-id=${\n        field.id\n      } ${field.namespace && `data-rule-namespace=${field.namespace}`}>${\n        field.text\n      }</pega-reference>`;\n      if (bookmark) {\n        editor.selection.moveToBookmark(bookmark);\n        editor.selection.setContent(fieldContent);\n      } else {\n        editor.insertContent(fieldContent);\n      }\n\n      modalMethods.current?.dismiss();\n    };\n\n    const modalProps = {\n      children: dynamicContentPicker,\n      heading: t('rte_insert_field'),\n      actions: (\n        <>\n          <Button variant='secondary' onClick={() => modalMethods.current?.dismiss()}>\n            {t('cancel')}\n          </Button>\n          <Button variant='primary' onClick={() => onSubmit(insertField)}>\n            {t('submit')}\n          </Button>\n        </>\n      ),\n      center: true,\n      onAfterClose: () => {\n        setBookmark(undefined);\n        setCurrentElementId('');\n        setCurrentElementContent('');\n        setCurrentElementNamespace('');\n        onActiveFieldChange({ id: '', text: '', namespace: '' });\n      },\n      onBeforeOpen: () => {\n        if (currentElementId) {\n          onActiveFieldChange({\n            id: currentElementId,\n            text: currentElementContent,\n            namespace: currentElementNamespace\n          });\n        }\n      }\n    };\n\n    const findAndRenameField = (fieldId: string) => {\n      if (!editor || !fieldMenuItems) return;\n\n      const selectedRange = editor.selection.getRng();\n      const endOffset = selectedRange.endOffset;\n      const stringToSearch = selectedRange.commonAncestorContainer.nodeValue?.slice(0, endOffset);\n      if (stringToSearch === undefined) return;\n\n      const splitSearch = stringToSearch.split(' ');\n      const fieldString = splitSearch[splitSearch.length - 1];\n      const range = editor.getDoc().createRange();\n\n      const startPos = stringToSearch.lastIndexOf(fieldString);\n      const endPos = startPos + fieldString.length;\n      range.setStart(selectedRange.commonAncestorContainer, startPos);\n      range.setEnd(selectedRange.commonAncestorContainer, endPos);\n      editor.getDoc().getSelection()?.removeAllRanges();\n      editor.getDoc().getSelection()?.addRange(range);\n\n      const selectedField = menuHelpers.getItem(fieldMenuItems, fieldId);\n      if (selectedField && isFieldMenuItem(selectedField)) {\n        editor.selection.setContent(\n          `<pega-reference role=\"button\" contenteditable=\"false\" data-rule-type=\"field\" data-rule-id=\"${\n            selectedField.id\n          }\" ${selectedField.namespace && `data-rule-namespace=${selectedField.namespace}`}>${\n            selectedField.primary\n          }</pega-reference>`\n        );\n        setShowFieldsPopover(false);\n      }\n    };\n\n    const hidePopover = () => {\n      if (fieldPopoverRef) setShowFieldsPopover(false);\n    };\n\n    const filterFieldMenu = (searchString: string) => {\n      setShowFieldsPopover(true);\n      setFieldMenuItems(fieldItems || []);\n      if (/\\s/.test(searchString)) {\n        setShowFieldsPopover(false);\n        return;\n      }\n      if (searchString && fieldMenuItems) {\n        const newFieldMenuItems: FieldItems[] = menuHelpers\n          .flatten(fieldMenuItems)\n          .filter(({ primary }) =>\n            primary.toLowerCase().startsWith(searchString.toLocaleLowerCase())\n          );\n        if (newFieldMenuItems) {\n          setShowFieldsPopover(true);\n          setFieldMenuItems(newFieldMenuItems);\n        } else setShowFieldsPopover(false);\n      }\n    };\n\n    const updateBookmarkAndCurrentElement = (editorSelection: EditorSelection) => {\n      const targetEl = editorSelection.getNode() as HTMLElement;\n      const fieldId = targetEl.getAttribute('data-rule-id');\n      const fieldNamespace = targetEl.getAttribute('data-rule-namespace');\n      const fieldValue = targetEl.innerText;\n      setBookmark(editorSelection.getBookmark());\n      setCurrentElementId(fieldId || '');\n      setCurrentElementContent(fieldValue);\n      setCurrentElementNamespace(fieldNamespace || '');\n    };\n\n    const handleElementClick = ({ target }: MouseEvent) => {\n      if (editor && target && (target as HTMLElement).tagName === 'PEGA-REFERENCE') {\n        updateBookmarkAndCurrentElement(editor.selection);\n      }\n      hidePopover();\n    };\n\n    const onInsertField = (incEditor: TinyMCEEditor) => {\n      const targetEl = incEditor.selection.getNode();\n      if (targetEl.tagName === 'PEGA-REFERENCE') {\n        updateBookmarkAndCurrentElement(incEditor.selection);\n      } else {\n        modalMethods.current = create(Modal, modalProps);\n      }\n    };\n\n    const isPegaRefActive = (incEditor: TinyMCEEditor) => {\n      const targetEl = incEditor.selection.getNode();\n      return targetEl.tagName === 'PEGA-REFERENCE';\n    };\n\n    const fieldSelectionPopover = (\n      <Popover\n        show={showFieldsPopover}\n        strategy='fixed'\n        ref={fieldPopoverRef}\n        target={{\n          getBoundingClientRect() {\n            return currentCursorPosition;\n          }\n        }}\n        modifiers={[\n          {\n            name: 'offset',\n            options: {\n              offset: () => {\n                const iframe = editorRef.current?.element?.querySelector('iframe');\n                const iframeRect = iframe?.getBoundingClientRect();\n                const x = iframeRect?.x ?? 0;\n                const y = iframeRect?.y ?? 0;\n                return [x, y];\n              }\n            }\n          }\n        ]}\n        placement='bottom-start'\n      >\n        {fieldMenuItems && (\n          <Menu\n            id={menuID}\n            items={fieldMenuItems}\n            as={StyledSearchPopover}\n            focusControlEl={editor?.getBody() || undefined}\n            mode='action'\n            onItemClick={findAndRenameField}\n            variant='drill-down'\n          />\n        )}\n      </Popover>\n    );\n\n    useEffect(() => {\n      if (currentElementId && currentElementContent)\n        modalMethods.current = create(Modal, modalProps);\n    }, [currentElementId, currentElementContent]);\n\n    useEffect(() => {\n      editor?.getDoc().addEventListener('click', handleElementClick);\n      return () => {\n        editor?.getDoc().removeEventListener('click', handleElementClick);\n      };\n    }, [editor, editorRef.current]);\n\n    useEffect(() => {\n      if (modalMethods.current) {\n        modalMethods.current.update(modalProps);\n      }\n    }, [modalProps]);\n\n    const onEditorChange: EditorProps['onChange'] = (formEditor?: TinyMCEEditor) => {\n      if (formEditor) {\n        const targetEl = formEditor.selection.getBoundingClientRect();\n        const { left = 0, top = 0 } = targetEl ?? {};\n        setCurrentCursorPosition({\n          ...formEditor.selection.getBoundingClientRect(),\n          x: left,\n          y: top,\n          toJSON: () => {}\n        });\n\n        if (formEditor.selection.isCollapsed()) {\n          // get the full line string\n          const selectedRange = formEditor.selection.getRng();\n          const endOffset = selectedRange.endOffset;\n          const stringToSearch = selectedRange.commonAncestorContainer.nodeValue?.slice(\n            0,\n            endOffset\n          );\n          const fieldString = stringToSearch?.split(' ')[stringToSearch.split(' ').length - 1];\n          if (\n            fieldString?.startsWith('@') &&\n            fieldString.indexOf('@') === fieldString.lastIndexOf('@')\n          ) {\n            filterFieldMenu(fieldString.slice(1));\n          } else setShowFieldsPopover(false);\n        }\n      }\n    };\n\n    const onKeyDown: EditorProps['onKeyDown'] = event => {\n      if (\n        (event?.key === 'Enter' ||\n          event?.key === 'ArrowLeft' ||\n          event?.key === 'ArrowRight' ||\n          event?.key === 'ArrowDown' ||\n          event?.key === 'ArrowUp') &&\n        !!fieldPopoverRef.current\n      ) {\n        event?.preventDefault();\n      }\n      if (event?.key === 'Escape' && !!fieldPopoverRef.current) {\n        hidePopover();\n      }\n    };\n\n    return (\n      <Editor\n        ref={editorRef}\n        {...restProps}\n        label={label}\n        toolbar={toolbar}\n        customComponents={[\n          {\n            createCustomElement: createPegaReferenceElement,\n            name: 'pega-reference',\n            extensionAttributes: ['contenteditable'],\n            style: pegaReferenceElementStyle\n          }\n        ]}\n        customActions={[\n          {\n            icon: 'code',\n            text: tooltip,\n            onMouseDown: () => {\n              modalMethods.current = create(Modal, modalProps);\n            },\n            active: isPegaRefActive,\n            shortcut: {\n              pattern: 'meta+191',\n              description: tooltip,\n              command: onInsertField\n            }\n          }\n        ]}\n        onInit={setEditor}\n        onChange={onEditorChange}\n        onBlur={() => {\n          onBlur?.();\n          hidePopover();\n        }}\n        onKeyDown={onKeyDown}\n        defaultValue={defaultValue}\n      >\n        {fieldSelectionPopover}\n      </Editor>\n    );\n  });\n\nexport default DynamicContentEditor;\n"]}